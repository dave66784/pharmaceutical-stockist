orders:
  get:
    tags:
      - Orders
    summary: Get authenticated user's orders
    operationId: getUserOrders
    security:
      - bearerAuth: []
    responses:
      '200':
        description: Order list
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../components/schemas/auth.yaml#/components/schemas/ApiResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../components/schemas/order.yaml#/components/schemas/Order'
      '401':
        description: Unauthorized

  post:
    tags:
      - Orders
    summary: Place a new order from the current cart
    operationId: createOrder
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/order.yaml#/components/schemas/OrderRequest'
    responses:
      '200':
        description: Order placed successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../components/schemas/auth.yaml#/components/schemas/ApiResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../components/schemas/order.yaml#/components/schemas/Order'
      '400':
        description: Cart is empty or insufficient stock
        content:
          application/json:
            schema:
              $ref: '../components/schemas/auth.yaml#/components/schemas/ApiResponse'
      '401':
        description: Unauthorized

orderDetail:
  get:
    tags:
      - Orders
    summary: Get order by ID
    description: |
      ⚠️ **Note:** The current implementation does not verify that the order belongs to the
      authenticated user. Any authenticated user can retrieve any order by ID.
      An authorisation check should be added (see security review).
    operationId: getOrderById
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    responses:
      '200':
        description: Order details
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../components/schemas/auth.yaml#/components/schemas/ApiResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../components/schemas/order.yaml#/components/schemas/Order'
      '401':
        description: Unauthorized
      '404':
        description: Order not found
        content:
          application/json:
            schema:
              $ref: '../components/schemas/auth.yaml#/components/schemas/ApiResponse'

orderReceipt:
  get:
    tags:
      - Orders
    summary: Download order receipt as PDF
    operationId: downloadOrderReceipt
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    responses:
      '200':
        description: PDF receipt file
        headers:
          Content-Disposition:
            schema:
              type: string
              example: 'attachment; filename="receipt_42.pdf"'
        content:
          application/pdf:
            schema:
              type: string
              format: binary
      '401':
        description: Unauthorized
      '404':
        description: Order not found

exportUserOrders:
  get:
    tags:
      - Orders
    summary: Export authenticated user's orders to Excel
    operationId: exportUserOrders
    security:
      - bearerAuth: []
    responses:
      '200':
        description: Excel file containing the user's orders
        headers:
          Content-Disposition:
            schema:
              type: string
              example: 'attachment; filename="orders.xlsx"'
        content:
          application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
            schema:
              type: string
              format: binary
      '401':
        description: Unauthorized
